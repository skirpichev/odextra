% Test for evolution of the solar system.

function demo_solar()
tspan = [0,365];
% Table III of http://iau-comm4.jpl.nasa.gov/de405iom/de405iom.pdf
m = [1,1/6023600,1/408523.71,1/332946.050895,1/3098708,...
     1/1047.3486,1/3497.898,1/22908.98,1/19412.24,1/135200000];
% Table IV.  Coordinates & momenta at JED 2440400.5 (June 28, 1969)
y0 = [m(1) * [-0.0000003517482825,0.0000051776245516,0.0000022291038556],...
      m(2) * [0.0033678460665285,0.0248893425409419,0.0129440718036641],...
      m(3) * [0.0109524203859526,0.0156125066152813,0.0063288762775591],...
      m(4) * [0.0168116200832907,0.0017431314053870,0.0007559737321629],...
      m(5) * [0.0144820048109846,0.0002372852487673,-0.0002837498575510],...
      m(6) * [0.0010923631195394,-0.0065232933425626,-0.0028230144378031],...
      m(7) * [-0.0032172026168370,0.0043306325527844,0.0019264178272449],...
      m(8) * [0.0002215404476082,-0.0037676538996767,-0.0016532444914441],...
      m(9) * [0.0026431230271517,-0.0015034921971370,-0.0006812710717939],...
      m(10) * [0.0003225614206968,-0.0031487486744659,-0.0010801816958473],...
      0.0045025071581463,0.0007670751005129,0.0002660580862096,...
      0.3572602074480422,-0.0915490527316210,-0.0859810319208761,...
      0.6082494267602045,-0.3491324543998684,-0.1955443458956939,...
      0.1160148927753046,-0.9266055561260659,-0.4018062765483065,...
      -0.1146886056013058,-1.3283665295535771,-0.6061551879562506,...
      -5.3842094067801511,-0.8312470356991036,-0.2250958486572985,...
      7.8898916979858358,4.5957078575699830,1.5584322051523174,...
      -18.2698980946940850,-1.1627140690156066,-0.2503719383072875,...
      -16.0595376822070435 ,-23.9429495784517492,-9.4004295388809425,...
      -30.4878237352859180,-0.8732645031545428,8.9113111554337117];
method = {'euler','eulert','midpoint','eulers','verlet','gauss'};
printf('Demo: Solar\n');
for i = 1:length(method)
  printf('solver: %s\n',method{i});
  switch method{i}
    case {'euler','eulerb'}
      N = 1e4;
    otherwise
      N = 1e3;
  end
  t{i} = linspace(tspan(1),tspan(2),N);
  y{i} = feval(method{i},@(y_) ode_solar(y_,m),t{i},y0);
  [f,H{i},P{i},L{i}] = ode_solar(y{i},m);
end
figure;
semilogy(t{1},abs(L{1}(:,1) - L{1}(1,1))+eps, '-;Euler;', ...
         t{2},abs(L{2}(:,1) - L{2}(1,1))+eps, '-;Trapesoidal rule;', ...
         t{3},abs(L{3}(:,1) - L{3}(1,1))+eps, '-;Implicit midpoint rule;', ...
         t{4},abs(L{4}(:,1) - L{4}(1,1))+eps, '-;Symplectic Euler;', ...
         t{5},abs(L{5}(:,1) - L{5}(1,1))+eps, '-;Verlet;',...
         t{6},abs(L{6}(:,1) - L{6}(1,1))+eps, '-;Gauss;');
title('Solar system problem, angular momentum conservation');
xlabel('t');
ylabel('|L_x - L_x(0)|');

figure;
semilogy(t{1},abs(H{1} - H{1}(1,:))+eps, '-;Euler;', ...
         t{2},abs(H{2} - H{2}(1,:))+eps, '-;Trapesoidal rule;', ...
         t{3},abs(H{3} - H{3}(1,:))+eps, '-;Implicit midpoint rule;', ...
         t{4},abs(H{4} - H{4}(1,:))+eps, '-;Symplectic Euler;', ...
         t{5},abs(H{5} - H{5}(1,:))+eps, '-;Verlet;',...
         t{6},abs(H{6} - H{6}(1,:))+eps, '-;Gauss;');
title('Solar system problem, energy conservation');
xlabel('t');
ylabel('|H - H(0)|');

figure;
y=y{6};
plot3(y(:,33+1),y(:,33+2),y(:,33+3), ...
      y(:,36+1),y(:,36+2),y(:,36+3), ...
      y(:,39+1),y(:,39+2),y(:,39+3), ...
      y(:,42+1),y(:,42+2),y(:,42+3));
title('Inner planets');
